---
author: Briana Lettsome
date: November 9th, 2018
title: "p8105_hw5_bjl2150"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rvest)
library(ggridges)
```

# Problem 1
```{r}
# Made a dataframe with all the file names
long = tibble(longitudinal = list.files(path = "./data", full.names = TRUE),
              map(longitudinal, read_csv)) %>% 
  janitor::clean_names() %>%
  unnest()
```

### Description of the raw dataset:

This dataset contains results of subjects who were a part of an experiment. There were twenty subjects (ten assigned to the control arm and ten assigned to the exerimental arm, respectively). The zipfile, which contained the data, was comprised of twenty Excel per subject (twenty files in total). Each Excel spreadsheet contained observatios over the eight weeks that they were followed.

```{r}
# Created this dataframe in order to extract the control 'arm' to be later added to another dataframe.
long_tidy = separate(long, longitudinal, into = c("control_arm", "id.csv", "period"), sep = "_") %>%
  select(-period) %>%
  separate(control_arm, into = c("data", "arm"), sep = "/data/") %>%
  select(-data, -id.csv, -(week_1:week_8))
  

# Created a new dataframe in order to get make the 'subject_id' through wrangling of the data.
two_long_tidy = long %>% 
  separate(longitudinal, into = c("control_arm", "id.csv", "data"), sep = "/") %>%
  select(-id.csv) %>%
  separate(data, into = c("subject_id", "csv"), sep = ".csv") %>%
  select(-control_arm, -csv) 

# Combined the two above dataframes to ensure that the 'arm' variable was included in the final dataframe.
final = cbind(long_tidy, two_long_tidy)


# Tidying the dataframe so that variable 'week' is in one column rather than spread out.
long_gather = gather(final, key = week, value = n, week_1:week_8) %>%
  separate(week, into = c("number", "week"), sep = "_") %>%
  select(-number)
```

## Problem 1.2
```{r}
# Making of spaghetti plot showing observations on each subject over time.
long_spaghetti = long_gather %>%
  distinct() %>%
  group_by(subject_id) 
  
## It works!!!
ggplot(long_spaghetti, aes(x = week, y = n, group = subject_id, color = arm)) + 
  geom_path() +
  labs(title = "Observations Over Time by Subject",
    x = "Week",
    y = "Observations",
    caption = "Figure 1 illlustrates how subject obervations varied over time individually and by arm allocation.")
```

Figure 1 shows the observational trends by each subject in addition trends by arm allocation. The blue lines correspond to the exposed group while the red lines correspond to the control group. 
According to the figure, the control arm had a smaller number of observations over the weeks. Contrastingly, the  experiment arm had higher numbers of observations over time. This figure suggests that the exeprimental arm may have had better outcomes as a result of trial drug that the research investigators were testing.


# Problem 2

```{r}
# Reading in the homicide data
library(tidyverse)
library(rvest)
library(httr)

homicide_data = read_csv(file = "./homicidedata.csv")
```


### Description of the raw dataset:

The homicide_data  provides information on the numbers of homicides commited within the fifty large U.S. cities. Within the dataset, the observations included are the vitcims' first and last name, age, race, city and state that the event transpired in as well as the disposition. The disposition in this context refers to the result of the homicide event. In other words, was the case closed, an arrest made, unsolved, et cetera. 

```{r}
# Making of the new variable 'city_state'
homicide_citystate = homicide_data %>%
  mutate(city_state = str_c(city, ", " , state)) %>%
  select(disposition, city_state)

# Data wragling and tidying of dataframe to get the 'total_homicides' and 'unsolved_homicides' variables
homicide_summarize = homicide_citystate %>% 
  group_by(disposition, city_state) %>%
  summarize(n = n()) %>%
  spread(key = disposition, value = n) %>%
  janitor::clean_names() %>%
  mutate(total_homicides = closed_by_arrest + closed_without_arrest + open_no_arrest) %>%
  mutate(unsolved_homicides = closed_without_arrest + open_no_arrest) %>%
  select(city_state, total_homicides, unsolved_homicides)
```

## Problem 2.2

### Utilzation of prop.test
```{r}
# Filtered out Baltimore, MD from the homicide_summarize dataframe.
baltimore = homicide_summarize %>%
  filter(city_state == "Baltimore, MD") 

# Using the prop.test function in order to get the proportions in Baltimore.
# Made the resulting test into and R oject named 'baltimore_propr.
  
baltimore_propr = prop.test(1825,2827, p=0.05) 

# Used the broom::tidy function in order to tidy up the resulting ouput. Then selected the estimate, and low and high confidence intervals.
baltimore_propr %>%
  broom::tidy() %>%
  select(estimate, conf.low, conf.high)
```

## Problem 2.3

city_wide_propr = map(homicide_summarize$city_state, prop.test)


```
map(weather_nest$data, ~lm(tmax ~ tmin, data = .x))





