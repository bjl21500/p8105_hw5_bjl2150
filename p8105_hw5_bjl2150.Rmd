---
author: Briana Lettsome
date: November 9th, 2018
title: "p8105_hw5_bjl2150"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(rvest)
library(ggridges)
```

# Problem 1
```{r}
# Made a dataframe with all the file names
long = tibble(longitudinal = list.files(path = "./data", full.names = TRUE),
              map(longitudinal, read_csv)) %>% 
  janitor::clean_names() %>%
  unnest()
```

### Description of the dataset

```{r}
# Created this dataframe in order to extract the control 'arm' to be later added to another dataframe.
long_tidy = separate(long, longitudinal, into = c("control_arm", "id.csv", "period"), sep = "_") %>%
  select(-period) %>%
  separate(control_arm, into = c("data", "arm"), sep = "/data/") %>%
  select(-data, -id.csv, -(week_1:week_8))
  

# Created a new datafram in order to get make the 'subject_id' through wrangling of the data.
two_long_tidy = long %>% 
  separate(longitudinal, into = c("control_arm", "id.csv", "data"), sep = "/") %>%
  select(-id.csv) %>%
  separate(data, into = c("subject_id", "csv"), sep = ".csv") %>%
  select(-control_arm, -csv) 

# Combined the two dataframes to ensure that the 'arm' variable was included in the final dataframe.
final = cbind(long_tidy, two_long_tidy)


# Tidying the dataframe so that variable 'week' is in one column rather than spread out.
long_gather = gather(final, key = week, value = n, week_1:week_8) %>%
  separate(week, into = c("number", "week"), sep = "_") %>%
  select(-number)

# Making of spaghetti plot shwoing observations on each subject over time.
long_spaghetti = long_gather %>%
  distinct() %>%
  group_by(subject_id) 
  
## It works!!!
ggplot(long_spaghetti, aes(x = week, y = n, group = subject_id, color = arm)) + 
  geom_path()
```

brfss_smart2010 %>% 
  select(year, locationabbr, locationdesc) %>% 
  distinct() %>%
  group_by(year) %>% 
  count(locationabbr) %>% 
  ggplot(aes(x = year, y = n, group = locationabbr, color = locationabbr)) +
  geom_path() + 
  labs(title = "Location count for each state by year") + 
  viridis::scale_color_viridis(
    name = "locationabbr", 
    discrete = TRUE)

brfss_spaghetti = brfss %>%
  group_by(locationabbr, year) %>%
  distinct(locationdesc) %>%
  summarize(location_numbers = n()) %>%
  ggplot(aes(x = year, y = location_numbers, color = locationabbr)) + 
  geom_line() 


# Problem 2

```{r}
# Reading in the homicide data
library(tidyverse)
library(rvest)
library(httr)

homicide_data = read_csv(file = "./homicidedata.csv")
```


### Description of raw data:

The homicide_data shows the numbers of homicides within the 

```{r}
# Making of the new variable 'city_state'
homicide_citystate = homicide_data %>%
  mutate(city_state = str_c(city, ", " , state)) %>%
  select(disposition, city_state)


homicide_summarize = homicide_citystate %>% 
  group_by(disposition, city_state) %>%
  summarize(n = n()) %>%
  spread(key = disposition, value = n) %>%
  janitor::clean_names() %>%
  mutate(total_homicides = closed_by_arrest + closed_without_arrest + open_no_arrest) %>%
  mutate(unsolved_homicides = closed_without_arrest + open_no_arrest)
```



  mutate(total_homicides = )

  separate(disposition, into = C("Closed by arrest", "Closed without arrest", "Open/No arrest")
  mutate(Closed = filter(disposition == "Closed without arrest"))
       
       %>%
mutate(unsolved_homicides = recode(disposition != "Close by arrest"))



homicide_summarize = homicide_citystate %>% 
mutate(total_homicide = disposition) %>%
mutate(unsolved_homicides = recode(disposition != "Close by arrest"))


mutate(unsolved_homicides = filter(disposition %in% c("Closed without arrest", "Open/No arrest")))
  
  homicide_summarize %>%
  group_by(city_state, disposition) %>%
  count()

balitmore = homicide_summarize %>%
  filter(city_state == "Baltimore, MD") %>%
  prop.test
```


homicide_summarize = homicide_citystate %>% 
  filter(disposition %in% c("Closed without arrest", "Open/No arrest")) %>%
  mutate(unsolved_homicides = recode(disposition, "disposition" = "Open/No arrest", disposition = "Closed without arrest")) %>%
  group_by(city_state, disposition, unsolved_homicides) %>%
  count()
